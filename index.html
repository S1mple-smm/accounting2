<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accounting System</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      background: #f0f2f5;
      color: #333;
    }
    h1 {
      text-align: center;
      padding: 20px;
      margin: 0;
      background: linear-gradient(90deg, #2c3e50, #34495e);
      color: white;
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ */
    .tabs {
      display: flex;
      justify-content: center;
      background: #34495e;
      border-bottom: 4px solid #1abc9c;
      padding: 10px 0;
      position: sticky;
      top: 0;
      z-index: 1000;
    }
    .tabs button {
      padding: 15px 40px;
      margin: 0 5px;
      background: none;
      border: none;
      color: #ecf0f1;
      font-size: 17px;
      cursor: pointer;
      transition: background 0.3s, color 0.3s;
    }
    .tabs button:hover {
      background: #1abc9c;
      color: white;
    }
    .tabs button.active {
      background: #1abc9c;
      color: white;
      border-bottom: 4px solid #16a085;
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤–∫–ª–∞–¥–æ–∫ */
    .tab-content {
      display: none;
      padding: 20px;
    }
    .tab-content.active {
      display: block;
    }
    .container {
      max-width: 900px;
      margin: 32px auto;
      background: white;
      padding: 36px 28px 32px 28px;
      border-radius: 24px;
      box-shadow: 0 5px 24px rgba(0, 0, 0, 0.10);
      min-width: 320px;
    }
    /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º –∏ —Ç–∞–±–ª–∏—Ü */
    label, input, select, button {
      font-size: 17px;
    }
    label {
      margin: 14px 0 8px 0;
      font-weight: 500;
      display: block;
    }
    input, select {
      padding: 14px 12px;
      border: 1.5px solid #bfc9d1;
      border-radius: 10px;
      width: 100%;
      box-sizing: border-box;
      margin-bottom: 10px;
      background: #f8fafc;
      transition: border 0.2s;
    }
    input:focus, select:focus {
      border: 1.5px solid #3498db;
      outline: none;
      background: #fff;
    }
    button {
      padding: 14px 28px;
      border: none;
      border-radius: 10px;
      background-color: #3498db;
      color: white;
      font-size: 1.1rem;
      font-weight: 600;
      transition: background 0.3s, box-shadow 0.3s;
      cursor: pointer;
      margin-top: 10px;
      box-shadow: 0 2px 8px rgba(44,62,80,0.07);
    }
    button:hover {
      background-color: #2980b9;
      box-shadow: 0 4px 16px rgba(44,62,80,0.13);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 28px;
      font-size: 1.05rem;
      background: #f8fafc;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(44,62,80,0.06);
    }
    th, td {
      border: 1px solid #e0e6ed;
      padding: 14px 8px;
      text-align: center;
    }
    th {
      background: #ecf0f1;
      font-weight: 700;
      font-size: 1.08rem;
    }
    tr:nth-child(even) {
      background: #f3f6fa;
    }
    tr:hover {
      background: #eaf6fb;
      transition: background 0.2s;
    }
    .delete-btn {
      background-color: #e74c3c;
      color: white;
      font-weight: 600;
      padding: 10px 18px;
      border-radius: 8px;
      border: none;
      transition: background 0.2s;
    }
    .delete-btn:hover {
      background-color: #c0392b;
    }
    .indicator {
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: inline-block;
      margin: 0 auto;
      box-shadow: 0 1px 3px rgba(44,62,80,0.10);
    }
    .green { background-color: #2ecc71; }
    .orange { background-color: #f39c12; }
    .red { background-color: #e74c3c; }
    /* –ë–ª–æ–∫ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –°–∫–ª–∞–¥–µ ‚Äì –ø–µ—Ä–µ–º–µ—â—ë–Ω –≤–≤–µ—Ä—Ö */
    .search-box {
      margin: 18px 0 28px;
    }
    /* –ë–ª–æ–∫ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –ø–æ–ª–µ–π –≤ —Å—Ç—Ä–æ–∫—É (–£—á—ë—Ç –∏ —Ñ–∏–ª—å—Ç—Ä—ã –¥–æ—Ö–æ–¥–∞) */
    .inline-group {
      display: flex;
      gap: 24px;
      align-items: flex-end;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    .inline-group label {
      flex: 1;
      min-width: 180px;
    }
    /* –ë–ª–æ–∫ –¥–ª—è —á–µ–∫–±–æ–∫—Å–æ–≤ (–ê—Ä–µ–Ω–¥–∞) */
    .checkbox-group {
      display: flex;
      flex-direction: row;
      gap: 32px;
      align-items: flex-start;
      margin: 18px 0 10px 0;
      padding-left: 2px;
    }
    .checkbox-group label {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0;
      font-weight: 500;
      cursor: pointer;
      user-select: none;
    }
    .checkbox-group input[type="checkbox"] {
      width: 20px;
      height: 20px;
      accent-color: #3498db;
      margin: 0 4px 0 0;
      cursor: pointer;
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª–æ–∫–æ–≤ —Ä–∞—Å—á—ë—Ç–∞ –¥–æ—Ö–æ–¥–∞ */
    .income-calc-block {
      margin-top: 32px;
      padding: 18px 18px 10px 18px;
      border: 1.5px solid #bfc9d1;
      border-radius: 12px;
      background: #f8fafc;
      box-shadow: 0 1px 4px rgba(44,62,80,0.06);
    }
    .income-calc-block h3 {
      margin-top: 0;
      margin-bottom: 12px;
      font-size: 1.18rem;
      color: #2980b9;
      font-weight: 600;
    }
    @media (max-width: 700px) {
      .container {
        padding: 12px 4vw 18px 4vw;
        min-width: unset;
      }
      .inline-group {
        flex-direction: column;
        gap: 0;
      }
      table, th, td {
        font-size: 0.98rem;
      }
    }

    @media (max-width: 700px) {
      .tabs {
        flex-wrap: wrap;
      }
      .tabs button {
        flex: 1 1 100%;
        margin: 5px 0;
        font-size: 15px;
        padding: 12px;
      }
    }

    .table-wrapper {
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }

    @media (min-width: 700px) {
      table {
        min-width: 600px;
      }
    }

  </style>
</head>
<body>
  <h1>Accounting System</h1>
  <div class="tabs">
    <button class="tab-btn active" data-tab="accounting">Accounting</button>
    <button class="tab-btn" data-tab="rental">Rental</button>
    <button class="tab-btn" data-tab="warehouse">Warehouse</button>
  </div>

  <!-- Tab: Accounting -->
  <div id="accounting" class="tab-content active">
    <div class="container">
  <h2>Income and Expense Accounting</h2>
      <form id="entryForm">
        <div class="inline-group">
          <label>Type:
            <select id="type">
              <option value="Sale">Sale</option>
              <option value="Rental">Rental</option>
              <option value="Repair">Repair</option>
            </select>
          </label>
          <label>Income/Expense:
            <select id="flow">
              <option value="income">Income</option>
              <option value="expense">Expense</option>
            </select>
          </label>
        </div>
        <label>Transaction Date:
          <input type="date" id="entryDate" required>
        </label>
        <!-- For sales, user specifies the part name with size in the format "Part (Size)" -->
        <label>Name:
          <input type="text" id="name" placeholder="For example: Product A (13)" required>
        </label>
        <label>Quantity:
          <input type="number" id="quantity" min="1" value="1">
        </label>
        <label>Amount:
          <input type="number" id="amount" required>
        </label>
        <button type="submit">Add Transaction</button>
      </form>

      <!-- Income calculation blocks -->
      <div id="incomeCalcDay" class="income-calc-block">
        <h3>Income for Selected Day</h3>
        <select id="filterDay"></select>
        <button id="calcIncomeDayBtn" style="margin-top: 10px;">Calculate</button>
        <p>Income for the day: <span id="incomeDayResult">0</span></p>
      </div>
      <div id="incomeCalcMonth" class="income-calc-block">
        <h3>Income for Selected Month</h3>
        <select id="filterMonth"></select>
        <button id="calcIncomeMonthBtn" style="margin-top: 10px;">Calculate</button>
        <p>Income for the month: <span id="incomeMonthResult">0</span></p>
      </div>
      <div id="incomeCalcYear" class="income-calc-block">
        <h3>Income for Selected Year</h3>
        <select id="filterYear"></select>
        <button id="calcIncomeYearBtn" style="margin-top: 10px;">Calculate</button>
        <p>Income for the year: <span id="incomeYearResult">0</span></p>
      </div>

      <!-- Table with entries -->
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Type</th>
              <th>Flow</th>
              <th>Date</th>
              <th>Name</th>
              <th>Quantity</th>
              <th>Amount</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody id="entryTable"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Tab: Rental -->
  <div id="rental" class="tab-content">
    <div class="container">
  <h2>Rental</h2>
      <form id="rentalForm">
        <label>First Name:
          <input type="text" id="rentalName" required>
        </label>
        <label>Last Name:
          <input type="text" id="rentalSurname" required>
        </label>
        <label>Phone:
          <input type="text" id="rentalPhone" required>
        </label>
        <label>Passport Series:
          <input type="text" id="rentalPassport" required>
        </label>
        <label>Date of Birth:
          <input type="date" id="rentalBirth" required>
        </label>
        <label>Date Given:
          <input type="date" id="rentalBikeGiven" required>
        </label>
        <label>Rental Period:
          <input type="number" id="rentalDuration" required>
          <select id="rentalUnit">
            <option value="minutes">Minutes</option>
            <option value="hours">Hours</option>
            <option value="days">Days</option>
            <option value="months">Months</option>
          </select>
        </label>
        <label>Rental Payment Date:
          <input type="date" id="rentalPaymentDate">
        </label>
        <label>Rental Amount:
          <input type="number" id="rentalAmount" required>
        </label>
        <div class="checkbox-group">
          <label><input type="checkbox" id="rentalPaid"> Payment Received</label>
          <label><input type="checkbox" id="rentalActive" checked> Rental Active</label>
        </div>
        <button type="submit">Save Rental</button>
      </form>

      <div class="table-wrapper">
        <table id="rentalTable">
          <thead>
            <tr>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Phone</th>
              <th>Passport</th>
              <th>Date Given</th>
              <th>Period</th>
              <th>Rental Amount</th>
              <th>Payment Date</th>
              <th>Paid</th>
              <th>Active</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Tab: Warehouse -->
  <div id="warehouse" class="tab-content">
    <div class="container">
  <h2>Warehouse</h2>
      <!-- Search block moved up -->
      <div class="search-box">
        <label>Search:
          <input type="text" id="searchInput" placeholder="Enter name...">
        </label>
      </div>
      <form id="stockForm">
        <label>Name:
          <input type="text" id="itemName" required>
        </label>
        <label>Quantity:
          <input type="number" id="itemQty" required>
        </label>
        <label>Size:
          <input type="text" id="itemSize">
        </label>
        <label>Additional Info:
          <input type="text" id="itemNote">
        </label>
        <button type="submit">Add to Warehouse</button>
      </form>

      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>Indicator</th>
              <th>Name</th>
              <th>Quantity</th>
              <th>Size</th>
              <th>Additional Info</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody id="stockTable"></tbody>
        </table>
      </div>
    </div>
  </div>


  <script type="module">
  import { Client, Databases } from "https://cdn.jsdelivr.net/npm/appwrite@13.0.0/+esm";

  // üîë Replace with your values:
  const PROJECT_ID   = "68b47642000e77647a56";    // from Settings ‚Üí General
  const DATABASE_ID  = "68b4777400163beca121";             // your database ID
  const ACCOUNTING   = "accounting_entries"; // collection ID
  const RENTALS      = "rentals";            // collection ID
  const WAREHOUSE    = "warehouse";          // collection ID

  // üöÄ Initialize Appwrite client
  const client = new Client()
    .setEndpoint("https://cloud.appwrite.io/v1")  // keep this unless you self-host
    .setProject(PROJECT_ID);

  // Database instance
  const databases = new Databases(client);

  // üëâ Make available globally so your other scripts can use them
  window.APPWRITE = { databases, PROJECT_ID, DATABASE_ID, ACCOUNTING, RENTALS, WAREHOUSE };
  </script>

  <!-- –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫ -->
  <script>
    const tabs = document.querySelectorAll('.tab-btn');
    const contents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
      tab.addEventListener('click', () => {
        const tabId = tab.getAttribute('data-tab');
        contents.forEach(c => c.classList.remove('active'));
        tabs.forEach(t => t.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        tab.classList.add('active');
      });
    });
  </script>

  <!-- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –£—á—ë—Ç–∞ –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ -->
  <script>
    let accountingEntries = JSON.parse(localStorage.getItem('accountingEntries')) || [];
    const entryForm = document.getElementById('entryForm');
    const entryTable = document.getElementById('entryTable');

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –¥–∞—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–æ–ª—è "–î–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏"
    document.addEventListener("DOMContentLoaded", function() {
      const today = new Date().toISOString().substr(0, 10);
      document.getElementById('entryDate').value = today;
      populateDateFilters();
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–∞–∑–±–æ—Ä–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–¥–∞–∂–∏, –æ–∂–∏–¥–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç "–ù–∞–∑–≤–∞–Ω–∏–µ (–†–∞–∑–º–µ—Ä)"
    function parseSaleName(saleName) {
      const regex = /(.*)\s*\(([^)]+)\)/;
      const match = saleName.match(regex);
      if (match) {
        return { baseName: match[1].trim(), size: match[2].trim() };
      }
      return null;
    }

    entryForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const entry = {
        type: document.getElementById('type').value,
        flow: document.getElementById('flow').value,
        date: document.getElementById('entryDate').value,
        name: document.getElementById('name').value,
        quantity: parseInt(document.getElementById('quantity').value),
        amount: parseFloat(document.getElementById('amount').value)
      };
      accountingEntries.push(entry);
      localStorage.setItem('accountingEntries', JSON.stringify(accountingEntries));
      // If type is "Sale", try to deduct from warehouse by name and size
      if (entry.type === "Sale") {
        const parsed = parseSaleName(entry.name);
        if (parsed) {
          for (let i = 0; i < stockItems.length; i++) {
            if (stockItems[i].name.toLowerCase() === parsed.baseName.toLowerCase() &&
                stockItems[i].size.toLowerCase() === parsed.size.toLowerCase()) {
              stockItems[i].qty = Math.max(0, stockItems[i].qty - entry.quantity);
              break;
            }
          }
        } else {
          // If format does not match, try to find by full name
          for (let i = 0; i < stockItems.length; i++) {
            if (stockItems[i].name.toLowerCase() === entry.name.toLowerCase()) {
              stockItems[i].qty = Math.max(0, stockItems[i].qty - entry.quantity);
              break;
            }
          }
        }
        localStorage.setItem('stockItems', JSON.stringify(stockItems));
        renderStock();
      }
      
      entryForm.reset();
      document.getElementById('entryDate').value = new Date().toISOString().substr(0, 10);
      renderAccounting();
      populateDateFilters();
    });

    function renderAccounting() {
      entryTable.innerHTML = '';
      accountingEntries.forEach((item, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.type}</td>
          <td>${item.flow === 'income' ? '–î–æ—Ö–æ–¥' : '–†–∞—Å—Ö–æ–¥'}</td>
          <td>${item.date}</td>
          <td>${item.name}</td>
          <td>${item.quantity}</td>
          <td>${item.amount}</td>
          <td><button class="delete-btn" onclick="deleteAccounting(${index})">–£–¥–∞–ª–∏—Ç—å</button></td>
        `;
        entryTable.appendChild(row);
      });
    }
    function deleteAccounting(index) {
      if (confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?")) {
        accountingEntries.splice(index, 1);
        localStorage.setItem('accountingEntries', JSON.stringify(accountingEntries));
        renderAccounting();
        populateDateFilters();
      }
    }
    renderAccounting();

    // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞ –¥–æ—Ö–æ–¥–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è
    document.getElementById('calcIncomeDayBtn').addEventListener('click', function() {
      const selectedDay = parseInt(document.getElementById('filterDay').value);
      let totalIncome = 0;
      // –£—á—ë—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏
      accountingEntries.forEach(entry => {
        const d = new Date(entry.date);
        if (d.getDate() === selectedDay) {
          totalIncome += (entry.flow === 'income' ? entry.amount : -entry.amount);
        }
      });
      // –ê—Ä–µ–Ω–¥–∞: —É—á–∏—Ç—ã–≤–∞–µ–º, –µ—Å–ª–∏ –æ–ø–ª–∞—á–µ–Ω–æ –∏ –¥–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
      rentalEntries.forEach(rental => {
        if (rental.paid && rental.paymentDate) {
          const d = new Date(rental.paymentDate);
          if (d.getDate() === selectedDay) {
            totalIncome += parseFloat(rental.rentalAmount || 0);
          }
        }
      });
      document.getElementById('incomeDayResult').innerText = totalIncome;
    });

    // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞ –¥–æ—Ö–æ–¥–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –º–µ—Å—è—Ü–∞
    document.getElementById('calcIncomeMonthBtn').addEventListener('click', function() {
      const selectedMonth = parseInt(document.getElementById('filterMonth').value);
      let totalIncome = 0;
      accountingEntries.forEach(entry => {
        const d = new Date(entry.date);
        if ((d.getMonth() + 1) === selectedMonth) {
          totalIncome += (entry.flow === 'income' ? entry.amount : -entry.amount);
        }
      });
      rentalEntries.forEach(rental => {
        if (rental.paid && rental.paymentDate) {
          const d = new Date(rental.paymentDate);
          if ((d.getMonth() + 1) === selectedMonth) {
            totalIncome += parseFloat(rental.rentalAmount || 0);
          }
        }
      });
      document.getElementById('incomeMonthResult').innerText = totalIncome;
    });

    // –§—É–Ω–∫—Ü–∏—è —Ä–∞—Å—á—ë—Ç–∞ –¥–æ—Ö–æ–¥–∞ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≥–æ–¥–∞
    document.getElementById('calcIncomeYearBtn').addEventListener('click', function() {
      const selectedYear = parseInt(document.getElementById('filterYear').value);
      let totalIncome = 0;
      accountingEntries.forEach(entry => {
        const d = new Date(entry.date);
        if (d.getFullYear() === selectedYear) {
          totalIncome += (entry.flow === 'income' ? entry.amount : -entry.amount);
        }
      });
      rentalEntries.forEach(rental => {
        if (rental.paid && rental.paymentDate) {
          const d = new Date(rental.paymentDate);
          if (d.getFullYear() === selectedYear) {
            totalIncome += parseFloat(rental.rentalAmount || 0);
          }
        }
      });
      document.getElementById('incomeYearResult').innerText = totalIncome;
    });

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ (–¥–µ–Ω—å, –º–µ—Å—è—Ü, –≥–æ–¥) –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞—Ç –∑–∞–ø–∏—Å–µ–π
    function populateDateFilters() {
      const daysSet = new Set();
      const monthsSet = new Set();
      const yearsSet = new Set();
      // –£—á—ë—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏
      accountingEntries.forEach(entry => {
        if (entry.date) {
          const d = new Date(entry.date);
          daysSet.add(d.getDate());
          monthsSet.add(d.getMonth() + 1);
          yearsSet.add(d.getFullYear());
        }
      });
      // –ê—Ä–µ–Ω–¥–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–∞ –¥–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã)
      rentalEntries.forEach(rental => {
        if (rental.paymentDate) {
          const d = new Date(rental.paymentDate);
          daysSet.add(d.getDate());
          monthsSet.add(d.getMonth() + 1);
          yearsSet.add(d.getFullYear());
        }
      });
      // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
      const filterDay = document.getElementById('filterDay');
      const filterMonth = document.getElementById('filterMonth');
      const filterYear = document.getElementById('filterYear');
      
      filterDay.innerHTML = '';
      filterMonth.innerHTML = '';
      filterYear.innerHTML = '';
      
      // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø—Ü–∏–π
      Array.from(daysSet).sort((a, b) => a - b).forEach(day => {
        const option = document.createElement('option');
        option.value = day;
        option.innerText = day;
        filterDay.appendChild(option);
      });
      Array.from(monthsSet).sort((a, b) => a - b).forEach(month => {
        const option = document.createElement('option');
        option.value = month;
        option.innerText = month;
        filterMonth.appendChild(option);
      });
      Array.from(yearsSet).sort((a, b) => a - b).forEach(year => {
        const option = document.createElement('option');
        option.value = year;
        option.innerText = year;
        filterYear.appendChild(option);
      });
    }
  </script>

  <!-- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –£—á—ë—Ç–∞ –∞—Ä–µ–Ω–¥—ã -->
  <script>
    let rentalEntries = JSON.parse(localStorage.getItem('rentalEntries')) || [];
    const rentalForm = document.getElementById('rentalForm');
    const rentalTableBody = document.querySelector('#rentalTable tbody');

    rentalForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const rental = {
        firstName: document.getElementById('rentalName').value,
        lastName: document.getElementById('rentalSurname').value,
        phone: document.getElementById('rentalPhone').value,
        passport: document.getElementById('rentalPassport').value,
        birth: document.getElementById('rentalBirth').value,
        bikeGiven: document.getElementById('rentalBikeGiven').value,
        duration: document.getElementById('rentalDuration').value,
        durationUnit: document.getElementById('rentalUnit').value,
        paymentDate: document.getElementById('rentalPaymentDate').value,
        rentalAmount: document.getElementById('rentalAmount').value,
        paid: document.getElementById('rentalPaid').checked,
        active: document.getElementById('rentalActive').checked
      };
      rentalEntries.push(rental);
      localStorage.setItem('rentalEntries', JSON.stringify(rentalEntries));
      rentalForm.reset();
      renderRental();
      populateDateFilters();
    });

    function renderRental() {
      // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ –æ–ø–ª–∞—Ç—ã (–∑–∞–ø–∏—Å–∏ –±–µ–∑ –¥–∞—Ç—ã ‚Äì –≤ –∫–æ–Ω–µ—Ü)
      rentalEntries.sort((a, b) => {
        const dateA = a.paymentDate ? new Date(a.paymentDate) : new Date(8640000000000000);
        const dateB = b.paymentDate ? new Date(b.paymentDate) : new Date(8640000000000000);
        return dateA - dateB;
      });
      rentalTableBody.innerHTML = '';
      rentalEntries.forEach((item, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.firstName}</td>
          <td>${item.lastName}</td>
          <td>${item.phone}</td>
          <td>${item.passport}</td>
          <td>${item.bikeGiven}</td>
          <td>${item.duration} ${item.durationUnit}</td>
          <td>${item.rentalAmount ? item.rentalAmount : 0}</td>
          <td>${item.paymentDate ? item.paymentDate : ''}</td>
          <td><input type="checkbox" onchange="toggleRentalPaid(${index}, this)" ${item.paid ? 'checked' : ''}></td>
          <td>${item.active ? '–î–∞' : '–ù–µ—Ç'}</td>
          <td><button class="delete-btn" onclick="deleteRental(${index})">–£–¥–∞–ª–∏—Ç—å</button></td>
        `;
        rentalTableBody.appendChild(row);
      });
    }
    function deleteRental(index) {
      if (confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?")) {
        rentalEntries.splice(index, 1);
        localStorage.setItem('rentalEntries', JSON.stringify(rentalEntries));
        renderRental();
        populateDateFilters();
      }
    }
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ "–û–ø–ª–∞—á–µ–Ω–æ" –ø–æ –∫–ª–∏–∫—É –Ω–∞ —á–µ–∫–±–æ–∫—Å
    function toggleRentalPaid(index, checkbox) {
      rentalEntries[index].paid = checkbox.checked;
      localStorage.setItem('rentalEntries', JSON.stringify(rentalEntries));
      renderRental();
      populateDateFilters();
    }
    renderRental();

  </script>

  <!-- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –°–æ—Å—Ç–∞–≤–∞ —Å–∫–ª–∞–¥–∞ -->
  <script>
    let stockItems = JSON.parse(localStorage.getItem('stockItems')) || [];
    const stockForm = document.getElementById('stockForm');
    const stockTable = document.getElementById('stockTable');
    const searchInput = document.getElementById('searchInput');

    stockForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const item = {
        name: document.getElementById('itemName').value,
        qty: parseInt(document.getElementById('itemQty').value),
        size: document.getElementById('itemSize').value,
        note: document.getElementById('itemNote').value
      };
      stockItems.push(item);
      localStorage.setItem('stockItems', JSON.stringify(stockItems));
      stockForm.reset();
      renderStock();
      populateDateFilters();
    });

    // –õ–æ–≥–∏–∫–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤: 0 ‚Üí –∫—Ä–∞—Å–Ω—ã–π, –º–µ–Ω—å—à–µ 12 ‚Üí –æ—Ä–∞–Ω–∂–µ–≤—ã–π, –æ—Ç 12 –∏ –≤—ã—à–µ ‚Üí –∑–µ–ª—ë–Ω—ã–π
    function getIndicator(qty) {
      if (qty === 0) return 'red';
      if (qty < 12) return 'orange';
      return 'green';
    }

    function renderStock() {
      const filter = searchInput.value.toLowerCase();
      stockTable.innerHTML = '';
      stockItems
        .filter(item => item.name.toLowerCase().includes(filter))
        .sort((a, b) => a.qty - b.qty)
        .forEach((item, index) => {
          const row = document.createElement('tr');
          const indicator = getIndicator(item.qty);
          row.innerHTML = `
            <td><span class="indicator ${indicator}"></span></td>
            <td>${item.name}</td>
            <td>${item.qty}</td>
            <td>${item.size}</td>
            <td>${item.note}</td>
            <td><button class="delete-btn" onclick="deleteStock(${index})">–£–¥–∞–ª–∏—Ç—å</button></td>
          `;
          stockTable.appendChild(row);
        });
    }

    function deleteStock(index) {
      if (confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?")) {
        stockItems.splice(index, 1);
        localStorage.setItem('stockItems', JSON.stringify(stockItems));
        renderStock();
        populateDateFilters();
      }
    }

    searchInput.addEventListener('input', renderStock);
    renderStock();
  </script>
</body>
</html>
